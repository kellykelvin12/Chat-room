<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>Unlock Chat</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
    function getCSRF() {
        const m = document.querySelector('meta[name="csrf-token"]');
        return m ? m.getAttribute('content') : '';
    }

    async function submitPassword() {
        const pw = document.getElementById('pw').value;
        const type = '{{ type }}';
        const id = '{{ id }}';
        const res = await fetch('/api/check_lock', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCSRF()
            },
            body: JSON.stringify({type: type, id: id, password: pw})
        });
        const data = await res.json();
        if (data.status === 'success') {
            // on success, redirect to chat
            window.location.href = data.redirect;
        } else {
            alert(data.message || 'Incorrect password');
        }
    }
    </script>
</head>
<body>
    <div class="container">
        <h2>Enter password to unlock</h2>
        {% if lock_message %}
            <div style="background:#ffe0e0;color:#a00;padding:12px 16px;border-radius:6px;margin-bottom:16px;">
                {{ lock_message }}
            </div>
        {% endif %}
        <input type="password" id="pw" placeholder="Password">
        <button onclick="submitPassword()">Unlock</button>
    </div>
</body>
</html>